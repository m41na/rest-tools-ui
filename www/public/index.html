<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <meta name="description" content="">
        <meta name="author" content="">
        
        <title>Test Page</title>
        <!-- Bootstrap Core CSS -->
        <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/todo.css" rel="stylesheet">

        <!-- Custom CSS -->
        <style>
            body {
                padding-top: 70px;
                /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
            }
            </style>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <div id="app">
            <select v-model="selected">
                <option disabled value="">Collections</option>
                <option v-for="item in collections" :value="item.id">{{item.title}}</option>
            </select>
            
            <div>Selected: {{ selected }}</div>            
            
            <div class="list-group">
                <button type="button" class="list-group-item list-group-item-action" @click="selectEndpoint(index)" v-for="item, index in endpoints">{{item.method}} {{item.path}}</button>
            </div>     
            
            <form class="form" v-if="endpoint.method">
                <div class="form-row">
                  <div class="col">
                      <select class="form-control" v-model="endpoint.method">
                          <option v-for="method in methods" :value="method" >{{method}}</option>
                      </select>
                  </div>
                  <div class="col">
                    <input type="text" class="form-control" v-model="endpoint.path" placeholder="Path">
                  </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <input type="text" class="form-control" v-model="endpoint.url" placeholder="Url">
                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <textarea type="text" class="form-control" v-model="endpoint.entity" placeholder="Request Body"></textarea>
                    </div>
                </div>
                <div class="list-group">
                    <button type="button" class="list-group-item list-group-item-action" @click="selectHeader(header)" v-for="(value, header) in endpoint.headers">{{header}} : {{value}}</button>
                </div>  
                <div class="form-row">
                    <div class="form-group col-md-6">
                      <label for="headerName">Header Name</label>
                      <input type="text" class="form-control" v-model="header" placeholder="Header Name">
                    </div>
                    <div class="form-group col-md-6">
                      <label for="headerValue">Header Value</label>
                      <input type="text" class="form-control" v-model="endpoint.headers[header]" placeholder="Header Value">
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="endpoint.execute" id="executeCheck">
                        <label class="form-check-label" for="executeCheck">
                            Execute
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" @click.prevent="executeEndpoint">Execute</button>
            </form>
        </div>
        
        <!-- jQuery Version 1.11.1 -->
        <script src="/vendor/jquery/jquery.js"></script>
        <!-- Bootstrap Core JavaScript -->
        <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
        <!-- Vue js -->
        <script type="text/javascript" src="/vendor/vuejs/vue.js"></script>
        <script type="text/javascript">
            var app = new Vue({
                el: "#app",
                data: {
                    selected: '',
                    collections: [],
                    endpoint: {},
                    header: '',
                    methods: ["GET","POST","PUT","DELETE","HEAD","OPTIONS"],
                    dataTypes: ["text/html","text/plain","application/json","application/xml"],
                    contentTypes: ["application/x-www-form-urlencoded","multipart/form-data"]
                },
                computed: {
                    endpoints(){
                        if(!this.selected){
                            return [];
                        }
                        else{
                            return this.collections.find(e=>e.id===this.selected).endpoints;
                        }
                    }
                },
                methods: {
                    selectEndpoint(index){
                        this.endpoint = this.endpoints[index];
                    },
                    selectHeader(header){
                        this.header = header;
                    },
                    executeEndpoint(){
                        var onSuccess = function(data){
                            console.log(data);
                        }.bind(this);
                        
                        var onFailure = function(xhr, status){
                            console.log(xhr.responseText);
                        }.bind(this);
                        
                        $.ajax({
                            url: '/ws/execute',
                            type: 'post',
                            data: JSON.stringify([this.endpoint]),
                            contentType: 'application/json',
                            dataType: 'json',
                            success: onSuccess,
                            error: onFailure
                        });
                    }
                },
                mounted(){
                    var onSuccess = function(data){
                        this.collections = data.rest.model.collections.map(e=> {
                            return {id: e.collectionId, title: e.collectionTitle, endpoints: e.endpoints};
                        });
                    }.bind(this);
                    
                    var onFailure = function(xhr, status){
                        console.log(xhr.responseText);
                    }.bind(this);
                        
                    $.ajax({
                        url: '/ws/rest',
                        type: 'get',
                        dataType: 'json',
                        success: onSuccess,
                        error: onFailure
                    });
                }
            });
        </script>
    </body>
</html>
